/*
 * @Author: hcluo
 * @Date: 2020-07-28 13:41:11
 * @LastEditors: hcluo
 * @LastEditTime: 2020-08-04 15:37:43
 * @Description: æ”¿åºœé¡¹ç›®
 */
import provincesMap from './provincemap.json';
import cityMap from './citymap.json';
import { registerMap, getMap } from 'echarts/lib/echarts';
import code2ECode from './code2ECode.json';
const specialCity = ['åŒ—äº¬', 'å¤©æ´¥', 'ä¸Šæµ·', 'é‡åº†', 'é¦™æ¸¯', 'æ¾³é—¨'];

// const code2ECode = {
//   '0304070000': 'taiwan',
//   '0303040000': 'hebei',
//   '0303050000': 'shanxi',
//   '0306020000': 'liaoning',
//   '0306030000': 'jilin',
//   '0306010000': 'heilongjiang',
//   '0301030000': 'jiangsu',
//   '0301050000': 'zhejiang',
//   '0301040000': 'anhui',
//   '0301070000': 'fujian',
//   '0301060000': 'jiangxi',
//   '0301020000': 'shandong',
//   '0304010000': 'henan',
//   '0304020000': 'hubei',
//   '0304030000': 'hunan',
//   '0304050000': 'guangdong',
//   '0304060000': 'hainan',
//   '0302020000': 'sichuan',
//   '0302030000': 'guizhou',
//   '0302040000': 'yunnan',
//   '0305010000': 'shanxi1',
//   '0305020000': 'gansu',
//   '0305040000': 'qinghai',
//   '0305050000': 'xinjiang',
//   '0304040000': 'guangxi',
//   '0303030000': 'neimenggu',
//   '0305030000': 'ningxia',
//   '0302050000': 'xizang',
//   '0303010000': 'beijing',
//   '0303020000': 'tianjin',
//   '0301010000': 'shanghai',
//   '0302010000': 'chongqing',
//   '0304080000': 'xianggang',
//   '0304090000': 'aomen',
//   '0303040200': '130100',
//   '0303040600': '130200',
//   '0303041000': '130300',
//   '0303040100': '130400',
//   '0303040900': '130500',
//   '0303040300': '130600',
//   '0303040400': '130700',
//   '0303040500': '130800',
//   '0303040800': '130900',
//   '0303040700': '131000',
//   '0303041200': '131100',
//   '0303050200': '140100',
//   '0303051000': '140200',
//   '0303050900': '140300',
//   '0303050300': '140400',
//   '0303050400': '140500',
//   '0303051100': '140600',
//   '0303051200': '140700',
//   '0303050600': '140800',
//   '0303051300': '140900',
//   '0303050500': '141000',
//   '0303051400': '141100',
//   '0303030100': '150100',
//   '0303030200': '150200',
//   '0303030300': '150300',
//   '0303030400': '150400',
//   '0303031400': '150500',
//   '0303030500': '150600',
//   '0303030800': '150700',
//   '0303030900': '150800',
//   '0303031000': '150900',
//   '0303031100': '152200',
//   '0303031200': '152500',
//   '0303031300': '152900',
//   '0306020100': '210100',
//   '0306020300': '210200',
//   '0306020400': '210300',
//   '0306021000': '210400',
//   '0306020500': '210500',
//   '0306020600': '210600',
//   '0306020700': '210700',
//   '0306021300': '210800',
//   '0306021400': '210900',
//   '0306021500': '211000',
//   '0306020900': '211100',
//   '0306020200': '211200',
//   '0306021600': '211300',
//   '0306021100': '211400',
//   '0306030100': '220100',
//   '0306030200': '220200',
//   '0306030900': '220300',
//   '0306030500': '220400',
//   '0306030400': '220500',
//   '0306031000': '220600',
//   '0306031100': '220700',
//   '0306031200': '220800',
//   '0306031300': '222400',
//   '0306010200': '230100',
//   '0306010300': '230200',
//   '0306010900': '230300',
//   '0306011000': '230400',
//   '0306011100': '230500',
//   '0306010800': '230600',
//   '0306010600': '230700',
//   '0306010500': '230800',
//   '0306011200': '230900',
//   '0306010400': '231000',
//   '0306011300': '231100',
//   '0306011400': '231200',
//   '0306011500': '232700',
//   '0301030100': '320100',
//   '0301030200': '320200',
//   '0301030700': '320300',
//   '0301030900': '320400',
//   '0301030400': '320500',
//   '0301031800': '320600',
//   '0301030800': '320700',
//   '0301032400': '320800',
//   '0301030600': '320900',
//   '0301030500': '321000',
//   '0301030300': '321100',
//   '0301031500': '321200',
//   '0301032500': '321300',
//   '0301050200': '330100',
//   '0301050500': '330200',
//   '0301050700': '330300',
//   '0301050400': '330400',
//   '0301050300': '330500',
//   '0301050600': '330600',
//   '0301050800': '330700',
//   '0301050100': '330800',
//   '0301051500': '330900',
//   '0301051700': '331000',
//   '0301052900': '331100',
//   '0301040200': '340100',
//   '0301040400': '340200',
//   '0301040300': '340300',
//   '0301042100': '340400',
//   '0301040500': '340500',
//   '0301041700': '340600',
//   '0301041000': '340700',
//   '0301040600': '340800',
//   '0301040900': '341000',
//   '0301040100': '341100',
//   '0301040800': '341200',
//   '0301040700': '341300',
//   '0301041500': '341500',
//   '0301041300': '341600',
//   '0301041900': '341700',
//   '0301042000': '341800',
//   '0301070300': '350100',
//   '0301070400': '350200',
//   '0301071500': '350300',
//   '0301070800': '350400',
//   '0301071000': '350500',
//   '0301070700': '350600',
//   '0301070900': '350700',
//   '0301071100': '350800',
//   '0301070500': '350900',
//   '0301060300': '360100',
//   '0301060900': '360200',
//   '0301061100': '360300',
//   '0301060400': '360400',
//   '0301060100': '360500',
//   '0301061400': '360600',
//   '0301060800': '360700',
//   '0301061200': '360800',
//   '0301060700': '360900',
//   '0301061300': '361000',
//   '0301060600': '361100',
//   '0301020100': '370100',
//   '0301020200': '370200',
//   '0301020300': '370300',
//   '0301022900': '370400',
//   '0301021500': '370500',
//   '0301020400': '370600',
//   '0301020500': '370700',
//   '0301020600': '370800',
//   '0301020700': '370900',
//   '0301022800': '371000',
//   '0301022600': '371100',
//   '0301020800': '371300',
//   '0301022200': '371400',
//   '0301020900': '371500',
//   '0301022100': '371600',
//   '0301023000': '371700',
//   '0304010300': '410100',
//   '0304012000': '410200',
//   '0304010100': '410300',
//   '0304010600': '410400',
//   '0304010400': '410500',
//   '0304012100': '410600',
//   '0304011300': '410700',
//   '0304010700': '410800',
//   '0304010900': '410900',
//   '0304010500': '411000',
//   '0304010800': '411100',
//   '0304012200': '411200',
//   '0304011900': '411300',
//   '0304010200': '411400',
//   '0304011400': '411500',
//   '0304011100': '411600',
//   '0304011200': '411700',
//   '0304020100': '420100',
//   '0304020300': '420200',
//   '0304021900': '420300',
//   '0304020500': '420500',
//   '0304020200': '420600',
//   '0304020900': '420700',
//   '0304021400': '420800',
//   '0304022000': '420900',
//   '0304020400': '421000',
//   '0304022100': '421100',
//   '0304022200': '421200',
//   '0304022300': '421300',
//   '0304022400': '422800',
//   '0304030100': '430100',
//   '0304030200': '430200',
//   '0304031100': '430300',
//   '0304030300': '430400',
//   '0304031400': '430500',
//   '0304030900': '430600',
//   '0304030400': '430700',
//   '0304030700': '430800',
//   '0304031500': '430900',
//   '0304031200': '431000',
//   '0304031300': '431100',
//   '0304031600': '431200',
//   '0304031700': '431300',
//   '0304031800': '433100',
//   '0304050100': '440100',
//   '0304050300': '440200',
//   '0304050700': '440300',
//   '0304050800': '440400',
//   '0304050600': '440500',
//   '0304050900': '440600',
//   '0304050200': '440700',
//   '0304051100': '440800',
//   '0304051900': '440900',
//   '0304051000': '441200',
//   '0304050400': '441300',
//   '0304050500': '441400',
//   '0304052900': '441500',
//   '0304053000': '441600',
//   '0304052200': '441700',
//   '0304051200': '441800',
//   '0304051300': '441900',
//   '0304052100': '442000',
//   '0304052300': '445100',
//   '0304052600': '445200',
//   '0304053100': '445300',
//   '0304040100': '450100',
//   '0304040200': '450200',
//   '0304040300': '450300',
//   '0304040400': '450400',
//   '0304040600': '450500',
//   '0304041000': '450600',
//   '0304041100': '450700',
//   '0304040800': '450800',
//   '0304040900': '450900',
//   '0304041200': '451000',
//   '0304040700': '451100',
//   '0304040500': '451200',
//   '0304041300': '451300',
//   '0304041400': '451400',
//   '0304060100': '460100',
//   '0304060200': '460200',
//   '0304062000': '460300',
//   '0302020100': '510100',
//   '0302020400': '510300',
//   '0302020300': '510400',
//   '0302021600': '510500',
//   '0302020900': '510600',
//   '0302020500': '510700',
//   '0302022400': '510800',
//   '0302021100': '510900',
//   '0302021300': '511000',
//   '0302021400': '511100',
//   '0302020600': '511300',
//   '0302022500': '511400',
//   '0302021200': '511500',
//   '0302022300': '511600',
//   '0302022600': '511700',
//   '0302022700': '511800',
//   '0302022800': '511900',
//   '0302022900': '512000',
//   '0302021500': '513200',
//   '0302023100': '513300',
//   '0302023000': '513400',
//   '0302030100': '520100',
//   '0302030500': '520200',
//   '0302030200': '520300',
//   '0302030400': '520400',
//   '0302030700': '522200',
//   '0302030800': '522300',
//   '0302030900': '522400',
//   '0302031100': '522600',
//   '0302031000': '522700',
//   '0302040100': '530100',
//   '0302040300': '530300',
//   '0302041200': '530400',
//   '0302040700': '530500',
//   '0302040500': '530600',
//   '0302041100': '530700',
//   '0302042000': '530800',
//   '0302041300': '530900',
//   '0302041400': '532300',
//   '0302041800': '532500',
//   '0302042300': '532600',
//   '0302041600': '532800',
//   '0302041900': '532900',
//   '0302041700': '533100',
//   '0302042100': '533300',
//   '0302042200': '533400',
//   '0302050100': '540100',
//   '0302050500': '542500',
//   '0305010100': '610100',
//   '0305010400': '610200',
//   '0305010300': '610300',
//   '0305010200': '610400',
//   '0305010500': '610500',
//   '0305010600': '610600',
//   '0305010700': '610700',
//   '0305010800': '610800',
//   '0305010900': '610900',
//   '0305011000': '611000',
//   '0305020100': '620100',
//   '0305020300': '620200',
//   '0305020600': '620300',
//   '0305020400': '620400',
//   '0305020700': '620500',
//   '0305020200': '620600',
//   '0305020800': '620700',
//   '0305020900': '620800',
//   '0305020500': '620900',
//   '0305021000': '621000',
//   '0305021100': '621100',
//   '0305021200': '621200',
//   '0305021300': '622900',
//   '0305021400': '623000',
//   '0305040100': '630100',
//   '0305040800': '632200',
//   '0305040900': '632300',
//   '0305041000': '632500',
//   '0305040500': '632600',
//   '0305040700': '632700',
//   '0305040400': '632800',
//   '0305030100': '640100',
//   '0305030300': '640200',
//   '0305030200': '640300',
//   '0305030400': '640400',
//   '0305030500': '640500',
//   '0305050100': '650100',
//   '0305050400': '650200',
//   '0305051300': '652300',
//   '0305052200': '652700',
//   '0305052300': '652800',
//   '0305052400': '652900',
//   '0305051400': '653000',
//   '0305051500': '653100',
//   '0305051600': '653200',
//   '0305051700': '654000',
//   '0305051800': '654200',
//   '0305051900': '654300',
// };

const fetchMapJson = url => {
  return fetch(url).then(response => {
    if (!response.ok) {
      return Promise.reject(response.status);
    }
    return response.json();
  });
};

export function handle(param, eChartInstance) {
  let name = param.name;
  if (
    name !== 'china' &&
    !(name in provincesMap) &&
    specialCity[name] === undefined &&
    specialCity[name] === null &&
    !(name in cityMap)
  ) {
    switch (name) {
      case 'æ–°ç–†':
        name = 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº';
        break;
      case 'å¹¿è¥¿':
        name = 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº';
        break;
      case 'å†…è’™å¤':
        name = 'å†…è’™å¤è‡ªæ²»åŒº';
        break;
      case 'å®å¤':
        name = 'å®å¤å›æ—è‡ªæ²»åŒº';
        break;
      case 'è¥¿è—':
        name = 'è¥¿è—è‡ªæ²»åŒº';
        break;
      default:
        name += 'çœ';
        break;
    }
  }

  let url;
  if (name in provincesMap) {
    url = `./mapJson/province/${provincesMap[name]}.json`;
  } else if (name in cityMap) {
    url = `./mapJson/city/${cityMap[name]}.json`;
  } else {
    console.warn(
      '%c ğŸ¥Ÿ é€‰æ‹©çš„åœ°åŒºæ— ä¸‹çº§åœ°å›¾æ•°æ®: ',
      'font-size:20px;background-color: #E41A6A;color:#fff;',
      name,
    );

    return;
  }

  fetchMapJson(url)
    .then(res => {
      registerMap(name, res);
      eChartInstance.setOption({
        series: [
          {
            type: 'map',
            map: name,
          },
        ],
      });
    })
    .catch(function(err) {
      console.warn(
        '%c ğŸ¥Ÿ åœ¨æœåŠ¡ç«¯æ²¡æœ‰é€‰æ‹©çš„åœ°åŒºçš„æ— ä¸‹çº§åœ°å›¾æ•°æ®: ',
        'font-size:20px;background-color: #E41A6A;color:#fff;',
        name,
      );
    });
}

let catchArray = [];
export default function(code) {
  let eCode = code2ECode[code];
  return new Promise((resolve, reject) => {
    if (catchArray.indexOf(eCode) !== -1) {
      resolve(eCode);
    } else {
      if (eCode) {
        fetchMapJson(`./mapJson/${eCode}.json`)
          .then(res => {
            registerMap(eCode, res);
            catchArray.push(eCode);
            resolve(eCode);
          })
          .catch(function(err) {
            console.warn(
              '%c ğŸ¥Ÿ é€‰æ‹©çš„åœ°åŒºæ— ä¸‹çº§åœ°å›¾æ•°æ®: ',
              'font-size:20px;background-color: #E41A6A;color:#fff;',
              code,
            );
            resolve('china');
          });
      } else {
        resolve('china');
      }
    }
  });
}
