{"version":3,"sources":["anchor/Anchor.jsx"],"names":["React","ReactDOM","PropTypes","classNames","addEventListener","Affix","getScroll","getRequestAnimationFrame","getDefaultTarget","window","getOffsetTop","element","getClientRects","length","rect","getBoundingClientRect","width","height","doc","ownerDocument","docElem","documentElement","top","clientTop","easeInOutCubic","t","b","c","d","cc","reqAnimFrame","scrollTo","href","offsetTop","target","callback","scrollTop","targetElement","document","getElementById","substring","eleOffsetTop","targetScrollTop","startTime","Date","now","frameFunc","timestamp","time","pageXOffset","history","pushState","Anchor","props","handleScroll","animating","bounds","setState","activeLink","getCurrentAnchor","handleScrollTo","link","updateInk","prefixCls","dom","findDOMNode","linkNode","getElementsByClassName","refs","ink","style","clientHeight","state","links","antAnchor","registerLink","includes","push","unregisterLink","index","indexOf","splice","getTarget","scrollEvent","remove","linkSections","forEach","maxSection","reduce","prev","curr","className","affix","showInkInFixed","children","inkClass","visible","wrapperClass","anchorClass","anchorContent","Component","defaultProps","childContextTypes","object"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\nimport Affix from '../affix';\nimport getScroll from '../_util/getScroll';\nimport getRequestAnimationFrame from '../_util/getRequestAnimationFrame';\nfunction getDefaultTarget() {\n    return window;\n}\nfunction getOffsetTop(element) {\n    if (!element) {\n        return 0;\n    }\n    if (!element.getClientRects().length) {\n        return 0;\n    }\n    const rect = element.getBoundingClientRect();\n    if (rect.width || rect.height) {\n        const doc = element.ownerDocument;\n        const docElem = doc && doc.documentElement;\n        if (docElem) {\n            return rect.top - docElem.clientTop;\n        }\n    }\n    return rect.top;\n}\nfunction easeInOutCubic(t, b, c, d) {\n    const cc = c - b;\n    t /= d / 2;\n    if (t < 1) {\n        return cc / 2 * t * t * t + b;\n    }\n    return cc / 2 * ((t -= 2) * t * t + 2) + b;\n}\nconst reqAnimFrame = getRequestAnimationFrame();\nfunction scrollTo(href, offsetTop = 0, target, callback = () => { }) {\n    const scrollTop = getScroll(target(), true);\n    const targetElement = document.getElementById(href.substring(1));\n    if (!targetElement) {\n        return;\n    }\n    const eleOffsetTop = getOffsetTop(targetElement);\n    const targetScrollTop = scrollTop + eleOffsetTop - offsetTop;\n    const startTime = Date.now();\n    const frameFunc = () => {\n        const timestamp = Date.now();\n        const time = timestamp - startTime;\n        window.scrollTo(window.pageXOffset, easeInOutCubic(time, scrollTop, targetScrollTop, 450));\n        if (time < 450) {\n            reqAnimFrame(frameFunc);\n        }\n        else {\n            callback();\n        }\n    };\n    reqAnimFrame(frameFunc);\n    history.pushState(null, '', href);\n}\nexport default class Anchor extends React.Component {\n    constructor(props) {\n        super(props);\n        this.handleScroll = () => {\n            if (this.animating) {\n                return;\n            }\n            const { offsetTop, bounds } = this.props;\n            this.setState({\n                activeLink: this.getCurrentAnchor(offsetTop, bounds),\n            });\n        };\n        this.handleScrollTo = (link) => {\n            const { offsetTop, target = getDefaultTarget } = this.props;\n            this.animating = true;\n            this.setState({ activeLink: link });\n            scrollTo(link, offsetTop, target, () => {\n                this.animating = false;\n            });\n        };\n        this.updateInk = () => {\n            if (typeof document === 'undefined') {\n                return;\n            }\n            const { prefixCls } = this.props;\n            const dom = ReactDOM.findDOMNode(this);\n            const linkNode = dom.getElementsByClassName(`${prefixCls}-link-title-active`)[0];\n            if (linkNode) {\n                this.refs.ink.style.top = `${linkNode.offsetTop + linkNode.clientHeight / 2 - 4.5}px`;\n            }\n        };\n        this.state = {\n            activeLink: null,\n        };\n        this.links = [];\n    }\n    getChildContext() {\n        return {\n            antAnchor: {\n                registerLink: (link) => {\n                    if (!this.links.includes(link)) {\n                        this.links.push(link);\n                    }\n                },\n                unregisterLink: (link) => {\n                    const index = this.links.indexOf(link);\n                    if (index !== -1) {\n                        this.links.splice(index, 1);\n                    }\n                },\n                activeLink: this.state.activeLink,\n                scrollTo: this.handleScrollTo,\n            },\n        };\n    }\n    componentDidMount() {\n        const getTarget = this.props.target || getDefaultTarget;\n        this.scrollEvent = addEventListener(getTarget(), 'scroll', this.handleScroll);\n        this.handleScroll();\n    }\n    componentWillUnmount() {\n        if (this.scrollEvent) {\n            this.scrollEvent.remove();\n        }\n    }\n    componentDidUpdate() {\n        this.updateInk();\n    }\n    getCurrentAnchor(offsetTop = 0, bounds = 5) {\n        let activeLink = '';\n        if (typeof document === 'undefined') {\n            return activeLink;\n        }\n        const linkSections = [];\n        this.links.forEach(link => {\n            const target = document.getElementById(link.substring(1));\n            if (target && getOffsetTop(target) < offsetTop + bounds) {\n                const top = getOffsetTop(target);\n                linkSections.push({\n                    link,\n                    top,\n                });\n            }\n        });\n        if (linkSections.length) {\n            const maxSection = linkSections.reduce((prev, curr) => curr.top > prev.top ? curr : prev);\n            return maxSection.link;\n        }\n        return '';\n    }\n    render() {\n        const { prefixCls, className = '', style, offsetTop, affix, showInkInFixed, children, } = this.props;\n        const { activeLink } = this.state;\n        const inkClass = classNames(`${prefixCls}-ink-ball`, {\n            visible: activeLink,\n        });\n        const wrapperClass = classNames(className, `${prefixCls}-wrapper`);\n        const anchorClass = classNames(prefixCls, {\n            'fixed': !affix && !showInkInFixed,\n        });\n        const anchorContent = (<div className={wrapperClass} style={style}>\n        <div className={anchorClass}>\n          <div className={`${prefixCls}-ink`}>\n            <span className={inkClass} ref=\"ink\"/>\n          </div>\n          {children}\n        </div>\n      </div>);\n        return !affix ? anchorContent : (<Affix offsetTop={offsetTop}>\n        {anchorContent}\n      </Affix>);\n    }\n}\nAnchor.defaultProps = {\n    prefixCls: 'w-anchor',\n    affix: true,\n    showInkInFixed: false,\n};\nAnchor.childContextTypes = {\n    antAnchor: PropTypes.object,\n};\n"],"file":"Anchor.js"}